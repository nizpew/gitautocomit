#!/bin/bash

# ==============================
# Script para limpar arquivos grandes, commitar e enviar ao GitHub
# ==============================

# Pega usuÃ¡rio do Git configurado
GIT_USER=$(git config user.name)

# Usa o nome da pasta atual como nome do repositÃ³rio
PROJECT_NAME=$(basename "$(pwd)").git

echo "ðŸ”Ž Projeto detectado: $PROJECT_NAME"
echo "ðŸ”Ž UsuÃ¡rio detectado: $GIT_USER"

# Adiciona e commita alteraÃ§Ãµes locais
echo "ðŸ“‚ Adicionando arquivos modificados..."
git add .

if git diff --cached --quiet; then
    echo "â„¹ï¸ Nenhuma alteraÃ§Ã£o para commitar."
else
    git commit -m "Auto commit: $(date '+%Y-%m-%d %H:%M:%S')"
    echo "âœ… Commit criado."
fi

# Instala git-filter-repo se necessÃ¡rio
if ! command -v git-filter-repo &> /dev/null; then
    echo "ðŸ“¦ Instalando git-filter-repo..."
    sudo apt update && sudo apt install -y git-filter-repo
else
    echo "âœ… git-filter-repo jÃ¡ instalado."
fi

# Remove arquivos grandes do histÃ³rico
echo "ðŸ§¹ Removendo arquivos maiores que 100MB do histÃ³rico..."
git filter-repo --strip-blobs-bigger-than 100M --force

# Ajusta remote
git remote remove origin 2>/dev/null
git remote add origin git@github.com:$GIT_USER/$PROJECT_NAME

# Faz push forÃ§ado
echo "ðŸš€ Enviando para o GitHub..."
git push origin main --force

echo "âœ… Processo concluÃ­do com sucesso!"

